<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha3/0.8.0/sha3.min.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asteroid Positions</title>
  </head>
  <body>
    <input
      type="number"
      id="numberOfPoints"
      placeholder="Number of Points"
      value="100"
      min="1"
    />
    <button onclick="drawPoints()">Generate Points</button>
    <button onclick="clearCanvas()">Clear</button>
    <button onclick="changeZoom(1.2)">Zoom In</button>
    <button onclick="changeZoom(0.8)">Zoom Out</button>
    <canvas id="plot" width="1000" height="1000"></canvas>

    <script>
      let zoomLevel = 1;

      let coordinates = [];
      function clearCanvas() {
        console.log("hello");
        coordinates = [];
        const input = document.getElementById("numberOfPoints");
        const value = input.value;
        console.log("input", input);
        input.value = "0";
        drawPoints();
        input.value = value;
      }

      function changeZoom(factor) {
        zoomLevel *= factor;
        drawPoints(); // Redraw the points with the new zoom level
      }

      function keccak256(...values) {
        const concatenatedValues = values.join("");
        return sha3_256(concatenatedValues);
      }

      function stringToRandomNumber(inputString) {
        let hash = 0;
        for (let i = 0; i < inputString.length; i++) {
          const charCode = inputString.charCodeAt(i);
          hash = (hash << 5) - hash + charCode;
          hash |= 0; // Convert to a 32-bit integer
        }
        return Math.abs(hash) / 0xffffffff;
      }

      function getDirection(asteroidCount, playerEntity, blockNumber) {
        const hash = Math.random() * 10000;
        const countMod27 = asteroidCount % 27;
        const countMod3 = asteroidCount % 3;
        const countMod4 = asteroidCount % 4;
        return countMod4 * 90 + countMod3 * 30 + countMod27;
      }

      function getPositionByVector(_distance, direction) {
        const angleDegs = direction % 360;

        const angleRads = (angleDegs * Math.PI) / 180;
        const x = Math.cos(angleRads) * _distance;
        const y = Math.sin(angleRads) * _distance;
        return { x: Math.floor(x), y: Math.floor(y) };
      }

      function getUniqueAsteroidPosition(
        playerEntity,
        asteroidCount,
        blockNumber
      ) {
        const distance = 260 * Math.log((asteroidCount + 105) / 10) - 580; // Apply the logarithmic function
        const position = getPositionByVector(
          distance,
          getDirection(asteroidCount, playerEntity, blockNumber)
        );
        return position;
      }

      function drawPoints() {
        const numberOfPoints = document.getElementById("numberOfPoints").value;
        const playerEntity = 12345; // Example value
        let blockNumber = 10000; // Example block number
        while (coordinates.length < numberOfPoints) {
          const i = coordinates.length;
          let coordinate = getUniqueAsteroidPosition(
            playerEntity,
            i,
            blockNumber
          );
          while (
            coordinates.filter(
              (c) =>
                Math.abs(c.x - coordinate.x) <= 1 &&
                Math.abs(c.y - coordinate.y) <= 1
            ).length > 0
          ) {
            coordinate = getUniqueAsteroidPosition(
              playerEntity,
              i,
              blockNumber + 1
            );
            blockNumber = blockNumber + 1;
          }
          coordinates.push(coordinate);
        }
        console.log(coordinates);
        const canvas = document.getElementById("plot");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ctx.beginPath();
        // ctx.moveTo(0, canvas.height / 2);
        // ctx.lineTo(canvas.width, canvas.height / 2);
        // ctx.moveTo(canvas.width / 2, 0);
        // ctx.lineTo(canvas.width / 2, canvas.height);
        // ctx.stroke();

        const unitInterval = 50 * zoomLevel; // Apply zoom to unit interval

        ctx.setTransform(
          zoomLevel,
          0,
          0,
          zoomLevel,
          (canvas.width * (1 - zoomLevel)) / 2,
          (canvas.height * (1 - zoomLevel)) / 2
        );
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = unitInterval; i < canvas.width / 2; i += unitInterval) {
          ctx.fillText(
            Math.round(i),
            canvas.width / 2 + i,
            canvas.height / 2 + 15
          );
          ctx.fillText(
            Math.round(-i),
            canvas.width / 2 - i,
            canvas.height / 2 + 15
          );
        }
        for (let i = unitInterval; i < canvas.height / 2; i += unitInterval) {
          ctx.fillText(
            Math.round(i),
            canvas.width / 2 + 5,
            canvas.height / 2 - i
          );
          ctx.fillText(
            Math.round(-i),
            canvas.width / 2 + 5,
            canvas.height / 2 + i
          );
        }

        for (const point of coordinates) {
          ctx.beginPath();
          ctx.arc(
            canvas.width / 2 + point.x,
            canvas.height / 2 - point.y,
            4,
            0,
            Math.PI * 2
          );
          ctx.fill();
        }
      }

      window.onload = drawPoints;
    </script>
  </body>
</html>
